/*!
 * @project JSDK JavaScript Development Kit
 * @copyright Copyright(c) 2004-2012, Dragonfly.org. All rights reserved.
 * @license LGPLv3
 * 
 * @version 0.1
 * @author feng.chun
 * @date 2011-09-19
 * 
 * @requires /core/js-core.js
 */
/*!
Copyright (c) 2010, Yahoo! Inc. All rights reserved.
Code licensed under the BSD License:
http://developer.yahoo.com/yui/license.html
version: 2.8.1
*/
YAHOO.util.Connect={_msxml_progid:["Microsoft.XMLHTTP","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP"],_http_headers:{},_has_http_headers:false,_use_default_post_header:true,_default_post_header:"application/x-www-form-urlencoded; charset=UTF-8",_default_form_header:"application/x-www-form-urlencoded",_use_default_xhr_header:true,_default_xhr_header:"XMLHttpRequest",_has_default_headers:true,_default_headers:{},_poll:{},_timeOut:{},_polling_interval:50,_transaction_id:0,startEvent:new YAHOO.util.CustomEvent("start"),completeEvent:new YAHOO.util.CustomEvent("complete"),successEvent:new YAHOO.util.CustomEvent("success"),failureEvent:new YAHOO.util.CustomEvent("failure"),abortEvent:new YAHOO.util.CustomEvent("abort"),_customEvents:{onStart:["startEvent","start"],onComplete:["completeEvent","complete"],onSuccess:["successEvent","success"],onFailure:["failureEvent","failure"],onUpload:["uploadEvent","upload"],onAbort:["abortEvent","abort"]},setProgId:function(a){this._msxml_progid.unshift(a);},setDefaultPostHeader:function(a){if(typeof a=="string"){this._default_post_header=a;}else{if(typeof a=="boolean"){this._use_default_post_header=a;}}},setDefaultXhrHeader:function(a){if(typeof a=="string"){this._default_xhr_header=a;}else{this._use_default_xhr_header=a;}},setPollingInterval:function(a){if(typeof a=="number"&&isFinite(a)){this._polling_interval=a;}},createXhrObject:function(b){var d,a,f;try{a=new XMLHttpRequest();d={conn:a,tId:b,xhr:true};}catch(e){for(f=0;f<this._msxml_progid.length;++f){try{a=new ActiveXObject(this._msxml_progid[f]);d={conn:a,tId:b,xhr:true};break;}catch(c){}}}finally{return d;}},getConnectionObject:function(a){var c,b=this._transaction_id;try{if(!a){c=this.createXhrObject(b);}else{c={tId:b};if(a==="xdr"){c.conn=this._transport;c.xdr=true;}else{if(a==="upload"){c.upload=true;}}}if(c){this._transaction_id++;}}catch(d){}return c;},asyncRequest:function(b,e,c,a){var d,f,g=(c&&c.argument)?c.argument:null;if(this._isFileUpload){f="upload";}else{if(c.xdr){f="xdr";}}d=this.getConnectionObject(f);if(!d){return null;}else{if(c&&c.customevents){this.initCustomEvents(d,c);}if(this._isFormSubmit){if(this._isFileUpload){this.uploadFile(d,c,e,a);return d;}if(b.toUpperCase()=="GET"){if(this._sFormData.length!==0){e+=((e.indexOf("?")==-1)?"?":"&")+this._sFormData;}}else{if(b.toUpperCase()=="POST"){a=a?this._sFormData+"&"+a:this._sFormData;}}}if(b.toUpperCase()=="GET"&&(c&&c.cache===false)){e+=((e.indexOf("?")==-1)?"?":"&")+"rnd="+new Date().valueOf().toString();}if(this._use_default_xhr_header){if(!this._default_headers["X-Requested-With"]){this.initHeader("X-Requested-With",this._default_xhr_header,true);}}if((b.toUpperCase()==="POST"&&this._use_default_post_header)&&this._isFormSubmit===false){this.initHeader("Content-Type",this._default_post_header);}if(d.xdr){this.xdr(d,b,e,c,a);return d;}d.conn.open(b,e,true);if(this._has_default_headers||this._has_http_headers){this.setHeader(d);}this.handleReadyState(d,c);d.conn.send(a||"");if(this._isFormSubmit===true){this.resetFormState();}this.startEvent.fire(d,g);if(d.startEvent){d.startEvent.fire(d,g);}return d;}},initCustomEvents:function(a,b){var c;for(c in b.customevents){if(this._customEvents[c][0]){a[this._customEvents[c][0]]=new YAHOO.util.CustomEvent(this._customEvents[c][1],(b.scope)?b.scope:null);a[this._customEvents[c][0]].subscribe(b.customevents[c]);}}},handleReadyState:function(c,b){var d=this,a=(b&&b.argument)?b.argument:null;if(b&&b.timeout){this._timeOut[c.tId]=window.setTimeout(function(){d.abort(c,b,true);},b.timeout);}this._poll[c.tId]=window.setInterval(function(){if(c.conn&&c.conn.readyState===4){window.clearInterval(d._poll[c.tId]);delete d._poll[c.tId];if(b&&b.timeout){window.clearTimeout(d._timeOut[c.tId]);delete d._timeOut[c.tId];}d.completeEvent.fire(c,a);if(c.completeEvent){c.completeEvent.fire(c,a);}d.handleTransactionResponse(c,b);}},this._polling_interval);},handleTransactionResponse:function(c,f,a){var j,d,h=(f&&f.argument)?f.argument:null,b=(c.r&&c.r.statusText==="xdr:success")?true:false,g=(c.r&&c.r.statusText==="xdr:failure")?true:false,e=a;try{if((c.conn.status!==undefined&&c.conn.status!==0)||b){j=c.conn.status;}else{if(g&&!e){j=0;}else{j=13030;}}}catch(i){j=13030;}if((j>=200&&j<300)||j===1223||b){d=c.xdr?c.r:this.createResponseObject(c,h);if(f&&f.success){if(!f.scope){f.success(d);}else{f.success.apply(f.scope,[d]);}}this.successEvent.fire(d);if(c.successEvent){c.successEvent.fire(d);}}else{switch(j){case 12002:case 12029:case 12030:case 12031:case 12152:case 13030:d=this.createExceptionObject(c.tId,h,(a?a:false));if(f&&f.failure){if(!f.scope){f.failure(d);}else{f.failure.apply(f.scope,[d]);}}break;default:d=(c.xdr)?c.response:this.createResponseObject(c,h);if(f&&f.failure){if(!f.scope){f.failure(d);}else{f.failure.apply(f.scope,[d]);}}}this.failureEvent.fire(d);if(c.failureEvent){c.failureEvent.fire(d);}}this.releaseObject(c);d=null;},createResponseObject:function(d,g){var a={},e={},i,b,h,c;try{b=d.conn.getAllResponseHeaders();h=b.split("\n");for(i=0;i<h.length;i++){c=h[i].indexOf(":");if(c!=-1){e[h[i].substring(0,c)]=YAHOO.lang.trim(h[i].substring(c+2));}}}catch(f){}a.tId=d.tId;a.status=(d.conn.status==1223)?204:d.conn.status;a.statusText=(d.conn.status==1223)?"No Content":d.conn.statusText;a.getResponseHeader=e;a.getAllResponseHeaders=b;a.responseText=d.conn.responseText;a.responseXML=d.conn.responseXML;if(g){a.argument=g;}return a;},createExceptionObject:function(b,f,a){var d=0,c="communication failure",g=-1,h="transaction aborted",e={};e.tId=b;if(a){e.status=g;e.statusText=h;}else{e.status=d;e.statusText=c;}if(f){e.argument=f;}return e;},initHeader:function(a,b,c){var d=(c)?this._default_headers:this._http_headers;d[a]=b;if(c){this._has_default_headers=true;}else{this._has_http_headers=true;}},setHeader:function(a){var b;if(this._has_default_headers){for(b in this._default_headers){if(YAHOO.lang.hasOwnProperty(this._default_headers,b)){a.conn.setRequestHeader(b,this._default_headers[b]);}}}if(this._has_http_headers){for(b in this._http_headers){if(YAHOO.lang.hasOwnProperty(this._http_headers,b)){a.conn.setRequestHeader(b,this._http_headers[b]);}}this._http_headers={};this._has_http_headers=false;}},resetDefaultHeaders:function(){this._default_headers={};this._has_default_headers=false;},abort:function(d,b,a){var e,g=(b&&b.argument)?b.argument:null;d=d||{};if(d.conn){if(d.xhr){if(this.isCallInProgress(d)){d.conn.abort();window.clearInterval(this._poll[d.tId]);delete this._poll[d.tId];if(a){window.clearTimeout(this._timeOut[d.tId]);delete this._timeOut[d.tId];}e=true;}}else{if(d.xdr){d.conn.abort(d.tId);e=true;}}}else{if(d.upload){var f="yuiIO"+d.tId;var c=document.getElementById(f);if(c){YAHOO.util.Event.removeListener(c,"load");document.body.removeChild(c);if(a){window.clearTimeout(this._timeOut[d.tId]);delete this._timeOut[d.tId];}e=true;}}else{e=false;}}if(e===true){this.abortEvent.fire(d,g);if(d.abortEvent){d.abortEvent.fire(d,g);}this.handleTransactionResponse(d,b,true);}return e;},isCallInProgress:function(a){a=a||{};if(a.xhr&&a.conn){return a.conn.readyState!==4&&a.conn.readyState!==0;}else{if(a.xdr&&a.conn){return a.conn.isCallInProgress(a.tId);}else{if(a.upload===true){return document.getElementById("yuiIO"+a.tId)?true:false;}else{return false;}}}},releaseObject:function(a){if(a&&a.conn){a.conn=null;a=null;}}};(function(){var c=YAHOO.util.Connect,b={};function f(k){var j='<object id="YUIConnectionSwf" type="application/x-shockwave-flash" data="'+k+'" width="0" height="0">'+'<param name="movie" value="'+k+'">'+'<param name="allowScriptAccess" value="always">'+"</object>",i=document.createElement("div");document.body.appendChild(i);i.innerHTML=j;}function h(i,l,k,m,j){b[parseInt(i.tId)]={"o":i,"c":m};if(j){m.method=l;m.data=j;}i.conn.send(k,m,i.tId);}function e(i){f(i);c._transport=document.getElementById("YUIConnectionSwf");}function g(){c.xdrReadyEvent.fire();}function a(i,j){if(i){c.startEvent.fire(i,j.argument);if(i.startEvent){i.startEvent.fire(i,j.argument);}}}function d(j){var i=b[j.tId].o,k=b[j.tId].c;if(j.statusText==="xdr:start"){a(i,k);return;}j.responseText=decodeURI(j.responseText);i.r=j;if(k.argument){i.r.argument=k.argument;}this.handleTransactionResponse(i,k,j.statusText==="xdr:abort"?true:false);delete b[j.tId];}c.xdr=h;c.swf=f;c.transport=e;c.xdrReadyEvent=new YAHOO.util.CustomEvent("xdrReady");c.xdrReady=g;c.handleXdrResponse=d;})();(function(){var e=YAHOO.util.Connect,c=YAHOO.util.Event;e._isFormSubmit=false;e._isFileUpload=false;e._formNode=null;e._sFormData=null;e._submitElementValue=null;e.uploadEvent=new YAHOO.util.CustomEvent("upload"),e._hasSubmitListener=function(){if(c){c.addListener(document,"click",function(h){var i=c.getTarget(h),j=i.nodeName.toLowerCase();if((j==="input"||j==="button")&&(i.type&&i.type.toLowerCase()=="submit")){e._submitElementValue=encodeURIComponent(i.name)+"="+encodeURIComponent(i.value);}});return true;}return false;}();function b(k,p,u){var l,v,m,o,h,n=false,r=[],i=0,s,q,t,j,w;this.resetFormState();if(typeof k=="string"){l=(document.getElementById(k)||document.forms[k]);}else{if(typeof k=="object"){l=k;}else{return;}}if(p){this.createFrame(u?u:null);this._isFormSubmit=true;this._isFileUpload=true;this._formNode=l;return;}for(s=0,q=l.elements.length;s<q;++s){v=l.elements[s];h=v.disabled;m=v.name;if(!h&&m){m=encodeURIComponent(m)+"=";o=encodeURIComponent(v.value);switch(v.type){case"select-one":if(v.selectedIndex>-1){w=v.options[v.selectedIndex];r[i++]=m+encodeURIComponent((w.attributes.value&&w.attributes.value.specified)?w.value:w.text);}break;case"select-multiple":if(v.selectedIndex>-1){for(t=v.selectedIndex,j=v.options.length;t<j;++t){w=v.options[t];if(w.selected){r[i++]=m+encodeURIComponent((w.attributes.value&&w.attributes.value.specified)?w.value:w.text);}}}break;case"radio":case"checkbox":if(v.checked){r[i++]=m+o;}break;case"file":case undefined:case"reset":case"button":break;case"submit":if(n===false){if(this._hasSubmitListener&&this._submitElementValue){r[i++]=this._submitElementValue;}n=true;}break;default:r[i++]=m+o;}}}this._isFormSubmit=true;this._sFormData=r.join("&");this.initHeader("Content-Type",this._default_form_header);return this._sFormData;}function f(){this._isFormSubmit=false;this._isFileUpload=false;this._formNode=null;this._sFormData="";}function g(j){var i="yuiIO"+this._transaction_id,h;if(YAHOO.env.ua.ie){h=document.createElement('<iframe id="'+i+'" name="'+i+'" />');if(typeof j=="boolean"){h.src="javascript:false";}}else{h=document.createElement("iframe");h.id=i;h.name=i;}h.style.position="absolute";h.style.top="-1000px";h.style.left="-1000px";document.body.appendChild(h);}function d(l){var i=[],k=l.split("&"),j,h;for(j=0;j<k.length;j++){h=k[j].indexOf("=");if(h!=-1){i[j]=document.createElement("input");i[j].type="hidden";i[j].name=decodeURIComponent(k[j].substring(0,h));i[j].value=decodeURIComponent(k[j].substring(h+1));this._formNode.appendChild(i[j]);}}return i;}function a(t,i,s,u){var n="yuiIO"+t.tId,m="multipart/form-data",k=document.getElementById(n),r=(document.documentMode&&document.documentMode===8)?true:false,h=this,l=(i&&i.argument)?i.argument:null,j,o,v,p,w,q;w={action:this._formNode.getAttribute("action"),method:this._formNode.getAttribute("method"),target:this._formNode.getAttribute("target")};this._formNode.setAttribute("action",s);this._formNode.setAttribute("method","POST");this._formNode.setAttribute("target",n);if(YAHOO.env.ua.ie&&!r){this._formNode.setAttribute("encoding",m);}else{this._formNode.setAttribute("enctype",m);}if(u){j=this.appendPostData(u);}this._formNode.submit();this.startEvent.fire(t,l);if(t.startEvent){t.startEvent.fire(t,l);}if(i&&i.timeout){this._timeOut[t.tId]=window.setTimeout(function(){h.abort(t,i,true);},i.timeout);}if(j&&j.length>0){for(o=0;o<j.length;o++){this._formNode.removeChild(j[o]);}}for(v in w){if(YAHOO.lang.hasOwnProperty(w,v)){if(w[v]){this._formNode.setAttribute(v,w[v]);}else{this._formNode.removeAttribute(v);}}}this.resetFormState();q=function(){if(i&&i.timeout){window.clearTimeout(h._timeOut[t.tId]);delete h._timeOut[t.tId];}h.completeEvent.fire(t,l);if(t.completeEvent){t.completeEvent.fire(t,l);}p={tId:t.tId,argument:i.argument};try{p.responseText=k.contentWindow.document.body?k.contentWindow.document.body.innerHTML:k.contentWindow.document.documentElement.textContent;p.responseXML=k.contentWindow.document.XMLDocument?k.contentWindow.document.XMLDocument:k.contentWindow.document;}catch(x){}if(i&&i.upload){if(!i.scope){i.upload(p);}else{i.upload.apply(i.scope,[p]);}}h.uploadEvent.fire(p);if(t.uploadEvent){t.uploadEvent.fire(p);}c.removeListener(k,"load",q);setTimeout(function(){document.body.removeChild(k);h.releaseObject(t);},100);};c.addListener(k,"load",q);}e.setForm=b;e.resetFormState=f;e.createFrame=g;e.appendPostData=d;e.uploadFile=a;})();YAHOO.register("connection",YAHOO.util.Connect,{version:"2.8.1",build:"19"});js.util.Ajax=YAHOO.util.Connect;