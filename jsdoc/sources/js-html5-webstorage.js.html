<!--  -->
<HTML>
<HEAD>
<TITLE></TITLE>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<LINK REL ="stylesheet" TYPE="text/css" HREF="../inc/stylesheet.css">
</HEAD>

<BODY style="margin:5px;">
<div style="float:right;">
<span class="button" onclick="if(window.history.length > 1) window.history.go(-1);">Back</span>
</div>
<div style="margin-left:5px;">util\js-html5-webstorage.js</div>
<pre class="source">
<span class="multiComment">/*!
 * @project JSDK JavaScript Development Kit
 * @copyright Copyright(c) 2004-2012, Dragonfly.org. All rights reserved.
 * @license LGPLv3
 * 
 * @version 0.1
 * @author feng.chun
 * @date 2011-7-28
 * 
 * @browsers FF 4+;Chrome 8+
 */</span>
js.lang.System.namespace('js.html5');

(<b>function </b>() {
<b>var </b>WebStorage = <b>function </b>(type){
    <b>this</b>.type = type;
    <b>this</b>._storage = window[type+'Storage'];
    <b>if </b>(!<b>this</b>._storage) <b>throw </b><b>new </b>Error("[js.html5."+type+'Storage'+"]The browser not support HTML5's WebStorage");
    
<span class="singleComment">    //创建事件    </span>
    <b>this</b>.createEvent('changed');
    <b>this</b>.createEvent('removed');
    <b>this</b>.createEvent('cleared');
}    
WebStorage.prototype = {
    get: <b>function </b>(k){
        <b>return</b> <b>this</b>._storage.getItem(k);
    },
    set: <b>function </b>(k, v){
        <b>var </b>old = <b>this</b>.get(k);
        <b>this</b>._storage.setItem(k, v);
        <b>this</b>.fireEvent('changed', k, old ,v);
    },
    remove: <b>function </b>(k){
        <b>var </b>old = <b>this</b>.get(k);
        <b>this</b>._storage.removeItem(k);
        <b>this</b>.fireEvent('removed', k, old);
    },
    clear: <b>function </b>(){
        <b>this</b>._storage.clear();
        <b>this</b>.fireEvent('cleared');
    },
    getLength: <b>function </b>(){
        <b>return</b> <b>this</b>._storage.length;
    }
};
js.lang.System.augment(WebStorage, js.core.EventProvider);

<span class="multiComment">/**
 * @class js.html5.SessionStorage
 * @static
 * @mix js.core.EventProvider
 * @throws {Error} when the browser not support HTML5's WebStorage
 * 
 * @event changed {
 *     "description":"fires after change a item"
 *        ,"type":"function"
 *     ,"scope":{"type":"js.html5.SessionStorage"}
 *     ,"arguments":{
 *         "type":"array"
 *         ,items:[
 *             {"type":"string","description":"item 's key"}
 *             ,{"type":"object","description":"item 's old value"}
 *             ,{"type":"object","description":"item 's new value"}
 *         ]
 *     }
 * }
 * @event removed {
 *     "description":"fires after remove a item"
 *        ,"type":"function"
 *     ,"scope":{"type":"js.html5.SessionStorage"}
 *     ,"arguments":{
 *         "type":"array"
 *         ,items:[
 *             {"type":"string","description":"item 's key"}
 *             ,{"type":"object","description":"item 's value"}
 *         ]
 *     }
 * }
 * @event cleared {
 *     "description":"fires after clear all items"
 *        ,"type":"function"
 *     ,"scope":{"type":"js.html5.SessionStorage"}
 *     ,"arguments":null
 * }
 */</span>
js.html5.SessionStorage = <b>new </b>WebStorage('session');
<span class="multiComment">/**
 * @method get
 * @param {String} k
 * @return {Object}
 */</span>
<span class="multiComment">/**
 * @method set
 * @param {String} k
 * @param {Object} v
 */</span>
<span class="multiComment">/**
 * @method remove
 * @param {String} k
 */</span>
<span class="multiComment">/**
 * @method clear
 */</span>
<span class="multiComment">/**
 * @method getLength
 * @return {Int}
 */</span>

<span class="multiComment">/**
 * @class js.html5.LocalStorage
 * @static
 * @mix js.core.EventProvider
 * @throws {Error} when the browser not support HTML5's WebStorage
 * 
 * @event changed {
 *     "description":"fires after change a item"
 *        ,"type":"function"
 *     ,"scope":{"type":"js.html5.SessionStorage"}
 *     ,"arguments":{
 *         "type":"array"
 *         ,items:[
 *             {"type":"string","description":"item 's key"}
 *             ,{"type":"object","description":"item 's old value"}
 *             ,{"type":"object","description":"item 's new value"}
 *         ]
 *     }
 * }
 * @event removed {
 *     "description":"fires after remove a item"
 *        ,"type":"function"
 *     ,"scope":{"type":"js.html5.SessionStorage"}
 *     ,"arguments":{
 *         "type":"array"
 *         ,items:[
 *             {"type":"string","description":"item 's key"}
 *             ,{"type":"object","description":"item 's value"}
 *         ]
 *     }
 * }
 * @event cleared {
 *     "description":"fires after clear all items"
 *        ,"type":"function"
 *     ,"scope":{"type":"js.html5.SessionStorage"}
 *     ,"arguments":null
 * }
 */</span>
js.html5.LocalStorage = <b>new </b>WebStorage('local');
<span class="multiComment">/**
 * @method get
 * @param {String} k
 * @return {Object}
 */</span>
<span class="multiComment">/**
 * @method set
 * @param {String} k
 * @param {Object} v
 */</span>
<span class="multiComment">/**
 * @method remove
 * @param {String} k
 */</span>
<span class="multiComment">/**
 * @method clear
 */</span>
<span class="multiComment">/**
 * @method getLength
 * @return {Int}
 */</span>
}());

</pre>
<hr/>
</BODY>
</HTML>
