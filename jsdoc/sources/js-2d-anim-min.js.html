<!--  -->
<HTML>
<HEAD>
<TITLE></TITLE>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<LINK REL ="stylesheet" TYPE="text/css" HREF="../inc/stylesheet.css">
</HEAD>

<BODY style="margin:5px;">
<div style="float:right;">
<span class="button" onclick="if(window.history.length > 1) window.history.go(-1);">Back</span>
</div>
<div style="margin-left:5px;">js2d\js-2d-anim-min.js</div>
<pre class="source">
<span class="multiComment">/*!
 * @project JSDK JavaScript Development Kit
 * @copyright Copyright(c) 2004-2012, Dragonfly.org. All rights reserved.
 * @license LGPLv3
 * 
 * @version 0.3
 * @author feng.chun
 * @date 2011-01-05
 * @date 2011-01-11
 * @date 2011-03-22
 * 
 * @version 0.2
 * @author feng.chun
 * @date 2010-12-31
 * 
 * @version 0.1
 * @author feng.chun
 * @date 2010-10-6
 * 
 * @requires /core/js-core.js
 * @requires /core/js-mathphys.js
 */</span>
js.lang.System.namespace("js.anim");(<b>function </b>(){<b>var </b>c=js.lang.System,e=js.core.Dom,d=js.core.Dom.$,b=js.math.MathTool,a=js.math.Geom2D;js.anim.Formulas={linear:<b>function </b>(g,f,i,h){<b>return</b> i*g/h+f;},quad_easein:<b>function </b>(g,f,i,h){<b>return</b> i*(g/=h)*g+f;},quad_easeout:<b>function </b>(g,f,i,h){<b>return</b> -i*(g/=h)*(g-2)+f;},quad_easeinout:<b>function </b>(g,f,i,h){<b>if </b>((g/=h/2)&lt;1){<b>return</b> i/2*g*g+f;}<b>return</b> -i/2*((--g)*(g-2)-1)+f;},cubic_easein:<b>function </b>(g,f,i,h){<b>return</b> i*(g/=h)*g*g+f;},cubic_easeout:<b>function </b>(g,f,i,h){<b>return</b> i*((g=g/h-1)*g*g+1)+f;},cubic_easeinout:<b>function </b>(g,f,i,h){<b>if </b>((g/=h/2)&lt;1){<b>return</b> i/2*g*g*g+f;}<b>return</b> i/2*((g-=2)*g*g+2)+f;},quart_easein:<b>function </b>(g,f,i,h){<b>return</b> i*(g/=h)*g*g*g+f;},quart_easeout:<b>function </b>(g,f,i,h){<b>return</b> -i*((g=g/h-1)*g*g*g-1)+f;},quart_easeinout:<b>function </b>(g,f,i,h){<b>if </b>((g/=h/2)&lt;1){<b>return</b> i/2*g*g*g*g+f;}<b>return</b> -i/2*((g-=2)*g*g*g-2)+f;},quint_easein:<b>function </b>(g,f,i,h){<b>return</b> i*(g/=h)*g*g*g*g+f;},quint_easeout:<b>function </b>(g,f,i,h){<b>return</b> i*((g=g/h-1)*g*g*g*g+1)+f;},quint_easeinout:<b>function </b>(g,f,i,h){<b>if </b>((g/=h/2)&lt;1){<b>return</b> i/2*g*g*g*g*g+f;}<b>return</b> i/2*((g-=2)*g*g*g*g+2)+f;},sine_easein:<b>function </b>(g,f,i,h){<b>return</b> -i*Math.cos(g/h*(Math.PI/2))+i+f;},sine_easeout:<b>function </b>(g,f,i,h){<b>return</b> i*Math.sin(g/h*(Math.PI/2))+f;},sine_easeinout:<b>function </b>(g,f,i,h){<b>return</b> -i/2*(Math.cos(Math.PI*g/h)-1)+f;},expo_easein:<b>function </b>(g,f,i,h){<b>return</b>(g==0)?f:i*Math.pow(2,10*(g/h-1))+f;},expo_easeout:<b>function </b>(g,f,i,h){<b>return</b>(g==h)?f+i:i*(-Math.pow(2,-10*g/h)+1)+f;},expo_easeinout:<b>function </b>(g,f,i,h){<b>if </b>(g==0){<b>return</b> f;}<b>if </b>(g==h){<b>return</b> f+i;}<b>if </b>((g/=h/2)&lt;1){<b>return</b> i/2*Math.pow(2,10*(g-1))+f;}<b>return</b> i/2*(-Math.pow(2,-10*--g)+2)+f;},circ_easein:<b>function </b>(g,f,i,h){<b>return</b> -i*(Math.sqrt(1-(g/=h)*g)-1)+f;},circ_easeout:<b>function </b>(g,f,i,h){<b>return</b> i*Math.sqrt(1-(g=g/h-1)*g)+f;},circ_easeinout:<b>function </b>(g,f,i,h){<b>if </b>((g/=h/2)&lt;1){<b>return</b> -i/2*(Math.sqrt(1-g*g)-1)+f;}<b>return</b> i/2*(Math.sqrt(1-(g-=2)*g)+1)+f;},elastic_easein:<b>function </b>(h,f,l,k,g,j){<b>if </b>(h==0){<b>return</b> f;}<b>if </b>((h/=k)==1){<b>return</b> f+l;}<b>if </b>(!j){j=k*0.3;}<b>if </b>(!g||g&lt;Math.abs(l)){g=l;<b>var </b>i=j/4;}<b>else </b>{<b>var </b>i=j/(2*Math.PI)*Math.asin(l/g);}<b>return</b> -(g*Math.pow(2,10*(h-=1))*Math.sin((h*k-i)*(2*Math.PI)/j))+f;},elastic_easeout:<b>function </b>(h,f,l,k,g,j){<b>if </b>(h==0){<b>return</b> f;}<b>if </b>((h/=k)==1){<b>return</b> f+l;}<b>if </b>(!j){j=k*0.3;}<b>if </b>(!g||g&lt;Math.abs(l)){g=l;<b>var </b>i=j/4;}<b>else </b>{<b>var </b>i=j/(2*Math.PI)*Math.asin(l/g);}<b>return</b>(g*Math.pow(2,-10*h)*Math.sin((h*k-i)*(2*Math.PI)/j)+l+f);},elastic_easeinout:<b>function </b>(h,f,l,k,g,j){<b>if </b>(h==0){<b>return</b> f;}<b>if </b>((h/=k/2)==2){<b>return</b> f+l;}<b>if </b>(!j){j=k*(0.3*1.5);}<b>if </b>(!g||g&lt;Math.abs(l)){g=l;<b>var </b>i=j/4;}<b>else </b>{<b>var </b>i=j/(2*Math.PI)*Math.asin(l/g);}<b>if </b>(h&lt;1){<b>return</b> -0.5*(g*Math.pow(2,10*(h-=1))*Math.sin((h*k-i)*(2*Math.PI)/j))+f;}<b>return</b> g*Math.pow(2,-10*(h-=1))*Math.sin((h*k-i)*(2*Math.PI)/j)*0.5+l+f;},back_easein:<b>function </b>(g,f,j,i,h){<b>if </b>(h==undefined){h=1.70158;}<b>return</b> j*(g/=i)*g*((h+1)*g-h)+f;},back_easeout:<b>function </b>(g,f,j,i,h){<b>if </b>(h==undefined){h=1.70158;}<b>return</b> j*((g=g/i-1)*g*((h+1)*g+h)+1)+f;},back_easeinout:<b>function </b>(g,f,j,i,h){<b>if </b>(h==undefined){h=1.70158;}<b>if </b>((g/=i/2)&lt;1){<b>return</b> j/2*(g*g*(((h*=(1.525))+1)*g-h))+f;}<b>return</b> j/2*((g-=2)*g*(((h*=(1.525))+1)*g+h)+2)+f;},bounce_easein:<b>function </b>(g,f,i,h){<b>return</b> i-<b>this</b>.bounce_easeout(h-g,0,i,h)+f;},bounce_easeout:<b>function </b>(g,f,i,h){<b>if </b>((g/=h)&lt;(1/2.75)){<b>return</b> i*(7.5625*g*g)+f;}<b>else </b>{<b>if </b>(g&lt;(2/2.75)){<b>return</b> i*(7.5625*(g-=(1.5/2.75))*g+0.75)+f;}<b>else </b>{<b>if </b>(g&lt;(2.5/2.75)){<b>return</b> i*(7.5625*(g-=(2.25/2.75))*g+0.9375)+f;}<b>else </b>{<b>return</b> i*(7.5625*(g-=(2.625/2.75))*g+0.984375)+f;}}}},bounce_easeinout:<b>function </b>(g,f,i,h){<b>if </b>(g&lt;h/2){<b>return</b> <b>this</b>.bounce_easein(g*2,0,i,h)*0.5+f;}<b>else </b>{<b>return</b> <b>this</b>.bounce_easeout(g*2-h,0,i,h)*0.5+i*0.5+f;}}};js.anim.Anim=<b>function </b>(f,g){<b>this</b>._config=f;<b>this</b>._method=g;<b>this</b>._isAnimated=<b>false</b>;<b>this</b>._startTime=<b>null</b>;<b>this</b>._counter=0;<b>this</b>._maxRepeat=f["repeat"]||0;<b>this</b>._repeat=0;<b>this</b>.createEvent("started");<b>this</b>.createEvent("completed");<b>this</b>.createEvent("stoped");<b>this</b>.createEvent("looped");<b>this</b>.createEvent("repeated");<b>this</b>._thread=<b>new </b>c.Thread(<b>this</b>,{interval:<b>this</b>._config["interval"]});};js.anim.Anim.prototype={setConfig:<b>function </b>(g,f){<b>this</b>._config[g]=f;},getConfig:<b>function </b>(f){<b>return</b> <b>this</b>._config[f];},getMaxTimes:<b>function </b>(){<b>return</b> <b>this</b>._maxRepeat;},getCurrentTimes:<b>function </b>(){<b>return</b> <b>this</b>._repeat;},getCount:<b>function </b>(){<b>return</b> <b>this</b>._counter;},isAnimated:<b>function </b>(){<b>return</b> <b>this</b>._isAnimated;},getStartTime:<b>function </b>(){<b>return</b> <b>this</b>._startTime;},start:<b>function </b>(){<b>if </b>(<b>this</b>.isAnimated()){<b>return</b>;}<b>this</b>._isAnimated=<b>true</b>;<b>this</b>._counter=0;<b>this</b>._repeat=0;<b>this</b>._startTime=<b>new </b>Date();<b>this</b>._thread.start();<b>this</b>.fireEvent("started");},resetCount:<b>function </b>(){<b>this</b>._counter=0;},run:<b>function </b>(){<b>if </b>(<b>typeof </b><b>this</b>._method=="function"){<b>var </b>f=<b>this</b>._method.call(<b>this</b>,<b>this</b>._counter,<b>this</b>._repeat);<b>this</b>._counter++;<b>this</b>.fireEvent("looped",<b>this</b>._counter,<b>this</b>._repeat);<b>if </b>(f){<b>this</b>._counter=0;<b>if </b>((<b>this</b>._repeat+1)&gt;<b>this</b>._maxRepeat){<b>this</b>.complete();}<b>else </b>{<b>this</b>._repeat++;<b>this</b>.fireEvent("repeated");}}}<b>else </b>{<b>this</b>.complete();}},complete:<b>function </b>(){<b>if </b>(!<b>this</b>.isAnimated()){<b>return</b>;}<b>this</b>._thread.stop();<b>this</b>._counter=0;<b>this</b>._isAnimated=<b>false</b>;<b>this</b>.fireEvent("completed");},stop:<b>function </b>(){<b>if </b>(!<b>this</b>.isAnimated()){<b>return</b>;}<b>this</b>._thread.stop();<b>this</b>._counter=0;<b>this</b>._isAnimated=<b>false</b>;<b>this</b>.fireEvent("stoped");}};c.augment(js.anim.Anim,js.core.EventProvider);js.anim.Film=<b>function </b>(h){<b>var </b>i=h["width"],k=h["height"],j=h["canvas"],g=h["frameSeq"],l=h["src"];<b>if </b>(!j||!g||!l){<b>throw </b><b>new </b>TypeError("[js.anim.Film]The arguments invalid.");}<b>this</b>._objArray=c.isString(h["target"])?[{"id":h["target"]}]:(h["target"]||[]);<b>var </b>f=<b>function </b>(m){<b>if </b>(m&gt;=g.length){<b>this</b>._objArray.forEach(<b>function </b>(n){j.erase(n["id"]);});<b>return</b> <b>true</b>;}<b>this</b>._objArray.forEach(<b>function </b>(n){<b>if </b>(c.isUndefined(n["id"])){n["id"]=c.getUUID();}<b>var </b>p=g[m],o={id:n["id"],z:n["z"]||0,width:i,height:k,src:l,x:n["x"]||0,y:n["y"]||0,offsetX:p[0],offsetY:p[1]};<b>if </b>(d(n["id"])){j.updateImage(o);}<b>else </b>{j.drawImage(o);}},<b>this</b>);<b>return</b> <b>false</b>;};js.anim.Film.superclass.constructor.call(<b>this</b>,h,f);};c.extend(js.anim.Film,js.anim.Anim,{setPosition:<b>function </b>(f,h){<b>var </b>g=<b>this</b>._objArray.indexOf(h,<b>function </b>(j,i){<b>return</b> j["id"]===i;});<b>if </b>(g&gt;-1){<b>this</b>._objArray[g]={id:h,x:f[0],y:f[1],z:f[2]};}<b>else </b>{<b>this</b>._objArray.push({id:h,x:f[0],y:f[1],z:f[2]});}}});js.anim.Motion=<b>function </b>(g){<b>var </b>k=g["target"],i=g["points"],m=i["to"];<b>if </b>(!k||!i||!m){<b>throw </b><b>new </b>TypeError("[js.anim.Motion]The arguments invalid.");}<b>this</b>._formula=g["formula"]||js.anim.Formulas.linear;<b>var </b>l=[i["from"]||e.getXY(k)],j=i["path"];<b>if </b>(j){l=l.concat(j);}l.push(m);<b>this</b>._ps=l;<b>this</b>._psIndex=0;<b>var </b>h=<b>function </b>(o,n,p){e.setStyle(o,"x",n);e.setStyle(o,"y",p);};<b>var </b>f=<b>function </b>(o){<b>var </b>q=<b>this</b>.getConfig("target"),p=<b>this</b>.getConfig("step")||1,u=<b>this</b>._ps[<b>this</b>._psIndex],s=<b>this</b>._ps[<b>this</b>._psIndex+1];<b>var </b>n=<b>this</b>._formula(o,u[0],s[0]-u[0],p),r=<b>this</b>._formula(o,u[1],s[1]-u[1],p);h(q,n,r);<b>if </b>(a.equalsPoint([n,r],<b>this</b>._ps[<b>this</b>._ps.length-1])){<b>this</b>._psIndex=0;<b>return</b> <b>true</b>;}<b>if </b>(a.equalsPoint(s,[n,r])){<b>this</b>._psIndex+=1;<b>this</b>.resetCount();}<b>return</b> <b>false</b>;};js.anim.Motion.superclass.constructor.call(<b>this</b>,g,f);};c.extend(js.anim.Motion,js.anim.Anim,{});js.anim.Flicker=<b>function </b>(h){<b>var </b>i=h["target"],f=h["opacity"];<b>if </b>(!i||!f){<b>throw </b><b>new </b>TypeError("[js.anim.Flicker]The arguments invalid.");}<b>this</b>._from=f["from"];<b>this</b>._to=f["to"];<b>if </b>(c.isUndefined(<b>this</b>._from)||c.isUndefined(<b>this</b>._to)){<b>throw </b><b>new </b>TypeError("[js.anim.Flicker]The arguments invalid.");}<b>var </b>g=<b>function </b>(k){<b>var </b>l=<b>this</b>.getConfig("step")||1,m=<b>this</b>.getConfig("target"),o=<b>this</b>._from,n=<b>this</b>._to;<b>var </b>j=o+k*(n-o)/l;e.setStyle(m,"opacity",j);<b>if </b>(b.equals(j,n)){<b>return</b> <b>true</b>;}};js.anim.Flicker.superclass.constructor.call(<b>this</b>,h,g);};c.extend(js.anim.Flicker,js.anim.Anim,{start:<b>function </b>(){<b>if </b>(!<b>this</b>.isAnimated()){<b>this</b>._from=c.isUndefined(<b>this</b>._from)?Number(e.getStyle(<b>this</b>.getConfig("target"),"opacity")):<b>this</b>._from;}js.anim.Motion.superclass.start.call(<b>this</b>);}});}());

</pre>
<hr/>
</BODY>
</HTML>
