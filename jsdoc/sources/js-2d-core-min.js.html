<!--  -->
<HTML>
<HEAD>
<TITLE></TITLE>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<LINK REL ="stylesheet" TYPE="text/css" HREF="../inc/stylesheet.css">
</HEAD>

<BODY style="margin:5px;">
<div style="float:right;">
<span class="button" onclick="if(window.history.length > 1) window.history.go(-1);">Back</span>
</div>
<div style="margin-left:5px;">js2d\js-2d-core-min.js</div>
<pre class="source">
<span class="multiComment">/*!
 * @project JSDK JavaScript Development Kit
 * @copyright Copyright(c) 2004-2012, Dragonfly.org. All rights reserved.
 * @license LGPLv3
 * 
 * @version 0.3
 * @author feng.chun
 * @date 2011-01-05
 * @date 2011-03-22
 * @date 2011-05-18
 * 
 * @version 0.2
 * @author feng.chun
 * @date 2010-11-15
 *
 * @version 0.1
 * @author feng.chun
 * @date 2010-9-20
 * 
 * @requires /core/js-core.js
 */</span>
js.lang.System.namespace("js.d2");(<b>function </b>(){<b>var </b>a=js.lang.System,d=js.core.Dom,c=js.core.Dom.$,e=js.core.Env,b=js.core.Event;js.d2.Canvas=<b>function </b>(f){<b>this</b>._config={id:f["id"]||a.getUUID(),html:f["html"]||"",title:f["title"]||"",cssName:f["cssName"]||"",x:f["x"]||0,y:f["y"]||0,z:f["z"]||0,opacity:a.isUndefined(f["opacity"])?1:f["opacity"],width:f["width"]||0,height:f["height"]||0,background:f["background"]||""};<b>this</b>._config["viewWindow"]=f["viewWindow"]||<b>this</b>.getBound();<b>this</b>._init();};js.d2.Canvas.prototype={setViewWindow:<b>function </b>(l,k,n,j){<b>var </b>o=<b>this</b>.getViewWindow(),g=!a.isUndefined(l),f=!a.isUndefined(k),i=!a.isUndefined(n),m=!a.isUndefined(j);<b>if </b>(!g&&!f&&!i&&!m){<b>return</b>;}<b>if </b>(i){o["w"]=n;}<b>if </b>(m){o["h"]=j;}<b>if </b>(g){<b>this</b>._config["x"]+=o["x"]-l;o["x"]=l;}<b>if </b>(f){<b>this</b>._config["y"]+=o["y"]-k;o["y"]=k;}<b>if </b>(g||f){d.updateEl(<b>this</b>._config["id"],<b>null</b>,{left:(-o["x"])+"px",top:(-o["y"])+"px"});}<b>if </b>(i||m){d.updateEl(<b>this</b>._config["id"]+"_view_window",<b>null</b>,{width:o.w+"px",height:o.h+"px"});}},moveViewPoint:<b>function </b>(o,n,h){<b>var </b>m=<b>this</b>.getViewWindow(),l=m["x"]+o,k=m["y"]+n;<b>if </b>(h){<b>var </b>j=h["x"],g=h["x"]+h["w"]-m["w"],i=h["y"],f=h["y"]+h["h"]-m["h"];<b>if </b>(l&lt;j){l=j;}<b>else </b>{<b>if </b>(l&gt;g){l=g;}}<b>if </b>(k&lt;i){k=i;}<b>else </b>{<b>if </b>(k&gt;f){k=f;}}}<b>this</b>.setViewWindow(l,k);},getViewWindow:<b>function </b>(){<b>return</b> <b>this</b>._config["viewWindow"];},getConfig:<b>function </b>(f){<b>return</b> f?<b>this</b>._config[f]:<b>this</b>._config;},_setupView:<b>function </b>(){<b>var </b>f=<b>this</b>.getViewWindow(),g="left:"+<b>this</b>._config["x"]+"px;top:"+<b>this</b>._config["y"]+"px;z-index:"+<b>this</b>._config["z"]+";";g+="width:"+f["w"]+"px;height:"+f["h"]+"px;";g+="position:absolute;overflow:hidden;";<b>this</b>._config["x"]-=f["x"];<b>this</b>._config["y"]-=f["y"];<b>return</b> g?{cssText:g}:<b>null</b>;},_calcCanvasXY:<b>function </b>(){<b>var </b>f=<b>this</b>.getViewWindow();<b>return</b>[-f["x"],-f["y"]];},_setupCanvas:<b>function </b>(){<b>var </b>g=<b>this</b>._calcCanvasXY();<b>var </b>f="position:absolute;overflow:hidden;left:"+g[0]+"px;top:"+g[1]+"px;z-index:"+<b>this</b>._config["z"]+";";f+="width:"+<b>this</b>._config["width"]+"px;height:"+<b>this</b>._config["height"]+"px;";<b>if </b>(<b>this</b>._config["opacity"]&lt;1){f+="filter:alpha(opacity:"+<b>this</b>._config["opacity"]*100+"); opacity:"+<b>this</b>._config["opacity"]+";";}f+="background:"+<b>this</b>._config["background"]+";";<b>return</b> f?{cssText:f}:<b>null</b>;},_init:<b>function </b>(){document.body.appendChild(d.createEl("div",{id:<b>this</b>._config["id"]+"_view_window",title:<b>this</b>._config["title"]},<b>this</b>._setupView()));c(<b>this</b>._config["id"]+"_view_window").appendChild(d.createEl("div",{id:<b>this</b>._config["id"],cssName:<b>this</b>._config["cssName"]},<b>this</b>._setupCanvas()));<b>this</b>._el=c(<b>this</b>._config["id"]);b.on(<b>this</b>._el,"contextmenu",<b>function </b>(f){b.stopEvent(f);});},hide:<b>function </b>(){<b>var </b>f=c(<b>this</b>._config["id"]+"_view_window");<b>if </b>(f){f.style.display="none";}},show:<b>function </b>(){<b>var </b>f=c(<b>this</b>._config["id"]+"_view_window");<b>if </b>(f){f.style.display="";}},getXY:<b>function </b>(){<b>return</b>[<b>this</b>._config["x"],<b>this</b>._config["y"]];},move:<b>function </b>(g,f){<b>var </b>h=<b>this</b>.getXY();<b>if </b>(!a.isUndefined(g)){h[0]+=g;}<b>if </b>(!a.isUndefined(f)){h[1]+=f;}<b>this</b>.setXY(h[0],h[1]);},setXY:<b>function </b>(f,h){<b>var </b>g=<b>this</b>.getViewWindow();<b>if </b>(!a.isUndefined(f)){<b>this</b>._config["x"]=f;d.setStyle(<b>this</b>._config["id"]+"_view_window","x",f);}<b>if </b>(!a.isUndefined(h)){<b>this</b>._config["y"]=h;d.setStyle(<b>this</b>._config["id"]+"_view_window","y",h);}},setSize:<b>function </b>(f,g){<b>if </b>(!a.isUndefined(f)){<b>this</b>._config["width"]=f;d.setStyle(<b>this</b>._config["id"],"width",f);}<b>if </b>(!a.isUndefined(g)){<b>this</b>._config["height"]=g;d.setStyle(<b>this</b>._config["id"],"height",g);}},getSize:<b>function </b>(){<b>return</b>[<b>this</b>._config["width"],<b>this</b>._config["height"]];},getBound:<b>function </b>(){<b>return</b>{x:0,y:0,w:<b>this</b>._config["width"],h:<b>this</b>._config["height"]};},getScreenBound:<b>function </b>(){<b>return</b>{x:<b>this</b>._config["x"],y:<b>this</b>._config["y"],w:<b>this</b>._config["width"],h:<b>this</b>._config["height"]};},_updateTextElement:<b>function </b>(f,g){d.setStyle(f,"opacity",a.isUndefined(g["opacity"])?1:g["opacity"]);d.setStyle(f,"visible",a.isUndefined(g["visible"])?<b>true</b>:g["visible"]);d.setStyle(f,"position","absolute");d.setStyle(f,"overflow","hidden");d.setStyle(f,"z",g["z"]);d.setStyle(f,"color",g["color"]);d.setStyle(f,"fontFamily",g["fontFamily"]);d.setStyle(f,"fontSize",g["fontSize"]);d.setStyle(f,"width",g["width"]);d.setStyle(f,"height",g["height"]);<b>if </b>(g["align"]=="center"){d.setStyle(f,"left","50%");d.setStyle(f,"marginLeft","-"+g["width"]/2+"px");}<b>else </b>{d.setStyle(f,"x",g["x"]);}<b>if </b>(g["valign"]=="middle"){d.setStyle(f,"top","50%");d.setStyle(f,"marginTop","-"+g["height"]/2+"px");}<b>else </b>{d.setStyle(f,"y",g["y"]);}d.setAttribute(f,"cssName",g["cssName"]);<b>if </b>(g["text"]){f.innerHTML=g["text"];}},drawText:<b>function </b>(g){<b>if </b>(!g){<b>throw </b><b>new </b>TypeError("[js.d2.Canvas#drawText]The arguments is empty.");}<b>var </b>f=c(g["id"]);<b>if </b>(f){<b>this</b>._updateTextElement(f,g);}<b>else </b>{f=<b>this</b>.createText(g);<b>this</b>._el.appendChild(f);}<b>return</b> f;},createText:<b>function </b>(g){<b>if </b>(!g){<b>throw </b><b>new </b>TypeError("[js.d2.Canvas#createText]The arguments is empty.");}<b>var </b>f=document.createElement("div");<b>this</b>._updateTextElement(f,g);d.setAttribute(f,"id",g["id"]||a.getUUID());<b>return</b> f;},updateText:<b>function </b>(g){<b>if </b>(!g){<b>throw </b><b>new </b>TypeError("[js.d2.Canvas#updateText]The arguments is empty.");}<b>var </b>f=c(g["id"]);<b>if </b>(f){<b>this</b>._updateTextElement(f,g);}<b>else </b>{<b>throw </b><b>new </b>Error("[js.d2.Canvas#updateText]Text's element not found.");}<b>return</b> f;},_updateImageElement:<b>function </b>(f,g){<b>if </b>(g["src"]){d.setStyle(f,"background","url("+g["src"]+") -"+(g["offsetX"]||0)+"px -"+(g["offsetY"]||0)+"px");}d.setStyle(f,"opacity",a.isUndefined(g["opacity"])?1:g["opacity"]);d.setStyle(f,"visible",a.isUndefined(g["visible"])?<b>true</b>:g["visible"]);d.setStyle(f,"position","absolute");d.setStyle(f,"overflow","hidden");d.setStyle(f,"x",g["x"]);d.setStyle(f,"y",g["y"]);d.setStyle(f,"z",g["z"]);d.setStyle(f,"width",g["width"]);d.setStyle(f,"height",g["height"]);d.setAttribute(f,"cssName",g["cssName"]);},drawImage:<b>function </b>(g){<b>if </b>(!g){<b>throw </b><b>new </b>Error("[js.d2.Canvas#drawImage]The arguments is empty.");}<b>var </b>f=c(g["id"]);<b>if </b>(f){<b>this</b>._updateImageElement(f,g);}<b>else </b>{f=<b>this</b>.createImage(g);<b>this</b>._el.appendChild(f);}<b>return</b> f;},createImage:<b>function </b>(g){<b>if </b>(!g){<b>throw </b><b>new </b>Error("[js.d2.Canvas#createImage]The arguments is empty.");}<b>var </b>f=document.createElement("div");<b>this</b>._updateImageElement(f,g);d.setAttribute(f,"id",g["id"]||a.getUUID());<b>return</b> f;},updateImage:<b>function </b>(g){<b>if </b>(!g){<b>throw </b><b>new </b>Error("[js.d2.Canvas#updateImage]The arguments is empty.");}<b>var </b>f=c(g["id"]);<b>if </b>(f){<b>this</b>._updateImageElement(f,g);}<b>else </b>{<b>throw </b><b>new </b>Error("[js.d2.Canvas#updateImage]Image's element not found.");}<b>return</b> f;},drawElement:<b>function </b>(f,g,j,h){<b>if </b>(!j){j={};}j["position"]="absolute";<b>var </b>i=d.createEl(f,g,j,h);<b>this</b>._el.appendChild(i);<b>return</b> i;},appendElement:<b>function </b>(f){<b>if </b>(f){<b>this</b>._el.appendChild(f);}},erase:<b>function </b>(g){<b>var </b>f=a.isArray(g)?g:[g];f.forEach(<b>function </b>(h){<b>var </b>i=c(h);<b>if </b>(i){b.purgeElement(i,<b>true</b>);<b>this</b>._el.removeChild(i);}},<b>this</b>);},destory:<b>function </b>(){<b>if </b>(<b>this</b>._el&&<b>this</b>._el.parentNode){b.purgeElement(<b>this</b>._el,<b>true</b>);<b>this</b>._el.parentNode.removeChild(<b>this</b>._el);}},clear:<b>function </b>(){b.purgeElement(<b>this</b>._el,<b>true</b>);<b>var </b>f=<b>this</b>._el.childNodes;<b>if </b>(!f){<b>return</b>;}<b>while </b>(f.length&gt;0){<b>var </b>g=<b>this</b>._el.childNodes[0];<b>this</b>._el.removeChild(g);}},printFPS:<b>function </b>(f){<b>this</b>.drawText({id:"fps",text:"FPS="+f,z:99,x:<b>this</b>.getConfig("width")-100,y:0,color:"yellow",fontSize:"18px"});}};js.d2.View=<b>function </b>(f){<b>this</b>._id=f["id"]||a.getUUID();<b>this</b>._x=a.isUndefined(f["x"])?0:f["x"];<b>this</b>._y=a.isUndefined(f["y"])?0:f["y"];<b>this</b>._z=a.isUndefined(f["z"])?0:f["z"];<b>this</b>._w=a.isUndefined(f["width"])?0:f["width"];<b>this</b>._h=a.isUndefined(f["height"])?0:f["height"];<b>this</b>._isV=a.isUndefined(f["visible"])?<b>true</b>:f["visible"];<b>this</b>._isD=<b>false</b>;<b>this</b>._isM=a.isUndefined(f["movable"])?<b>true</b>:f["movable"];<b>this</b>._opacity=a.isUndefined(f["opacity"])?1:f["opacity"];<b>this</b>.createEvent("painting");<b>this</b>.createEvent("painted");<b>this</b>.createEvent("destorying",<b>true</b>);<b>this</b>.createEvent("destoryed",<b>true</b>);<b>this</b>.createEvent("moving");<b>this</b>.createEvent("moved");};js.d2.View.prototype={getId:<b>function </b>(){<b>return</b> <b>this</b>._id;},getBound:<b>function </b>(){<b>return</b>{x:<b>this</b>._x,y:<b>this</b>._y,w:<b>this</b>._w,h:<b>this</b>._h};},getScreenBound:<b>function </b>(){<b>var </b>f=d.getXY(<b>this</b>._id);<b>if </b>(f){<b>return</b>{x:f[0],y:f[1],w:<b>this</b>._w,h:<b>this</b>._h};}<b>return</b> <b>null</b>;},getWidth:<b>function </b>(){<b>return</b> <b>this</b>._w;},getHeight:<b>function </b>(){<b>return</b> <b>this</b>._h;},getSize:<b>function </b>(){<b>return</b>[<b>this</b>._w,<b>this</b>._h];},setSize:<b>function </b>(f,g){<b>this</b>._w=f;<b>this</b>._h=g;},getX:<b>function </b>(){<b>return</b> <b>this</b>._x;},getY:<b>function </b>(){<b>return</b> <b>this</b>._y;},getZ:<b>function </b>(){<b>return</b> <b>this</b>._z;},setX:<b>function </b>(f){<b>if </b>(!<b>this</b>.isMovable()){<b>return</b>;}<b>this</b>._x=f;},setY:<b>function </b>(f){<b>if </b>(!<b>this</b>.isMovable()){<b>return</b>;}<b>this</b>._y=f;},setZ:<b>function </b>(f){<b>if </b>(!<b>this</b>.isMovable()){<b>return</b>;}<b>this</b>._z=f;},setXY:<b>function </b>(f,g){<b>if </b>(!<b>this</b>.isMovable()){<b>return</b>;}<b>this</b>._x=f;<b>this</b>._y=g;},getXY:<b>function </b>(){<b>return</b>[<b>this</b>._x,<b>this</b>._y];},isMovable:<b>function </b>(){<b>return</b> <b>this</b>._isM;},setMovable:<b>function </b>(f){<b>this</b>._isM=f;},setOpacity:<b>function </b>(f){<b>this</b>._opacity=f;},getOpacity:<b>function </b>(){<b>return</b> <b>this</b>._opacity;},move:<b>function </b>(g,f){<b>if </b>(!<b>this</b>.isMovable()){<b>return</b>;}<b>var </b>h=[Number(<b>this</b>._x),Number(<b>this</b>._y)];<b>this</b>.fireEvent("moving",h);<b>this</b>._x+=g;<b>this</b>._y+=f;<b>this</b>.fireEvent("moved",h,[<b>this</b>._x,<b>this</b>._y]);},isVisible:<b>function </b>(){<b>return</b> <b>this</b>._isV;},setVisible:<b>function </b>(f){<b>this</b>._isV=f;},isDestoryed:<b>function </b>(){<b>return</b> <b>this</b>._isD;},destory:<b>function </b>(f){<b>this</b>.fireEvent("destorying");f.erase(<b>this</b>.getId());<b>this</b>._isV=<b>false</b>;<b>this</b>._isD=<b>true</b>;<b>this</b>.fireEvent("destoryed");<b>this</b>.unsubscribeAll();},paint:<b>function </b>(f){}};a.augment(js.d2.View,js.core.EventProvider);}());

</pre>
<hr/>
</BODY>
</HTML>
